<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>相册管理</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .photo-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 8px;
            padding: 15px;
        }
        
        .photo-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 8px;
            overflow: hidden;
            background: #f5f5f5;
        }
        
        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .photo-item .select-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.3);
            display: none;
            align-items: center;
            justify-content: center;
        }
        
        .photo-item.selected .select-overlay {
            display: flex;
        }
        
        .photo-item .select-checkbox {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 20px;
            height: 20px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 50%;
            display: none;
        }
        
        .photo-item .select-checkbox.checked {
            background: #007AFF;
            border-color: #007AFF;
        }
        
        .photo-item .select-checkbox.checked::after {
            content: '✓';
            color: white;
            font-size: 12px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .batch-mode .photo-item .select-checkbox {
            display: block;
        }
        
        .batch-actions {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 15px;
            border-top: 1px solid #eee;
            display: none;
            flex-direction: row;
            justify-content: space-between;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }
        
        .batch-actions.show {
            display: flex;
        }
        
        .batch-info {
            flex: 1;
            display: flex;
            align-items: center;
            color: #666;
        }
        
        .batch-buttons {
            display: flex;
            gap: 10px;
        }
        
        .batch-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
        }
        
        .batch-btn.cancel {
            background: #f5f5f5;
            color: #666;
        }
        
        .batch-btn.delete {
            background: #FF3B30;
            color: white;
        }
        
        .batch-btn.album-delete {
            background: #FF9500;
            color: white;
        }
        
        .album-header {
            padding: 15px;
            background: white;
            border-bottom: 1px solid #eee;
        }
        
        .album-info h2 {
            margin: 0 0 5px 0;
            font-size: 18px;
            color: #333;
        }
        
        .album-meta {
            color: #666;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 顶部导航栏 -->
        <header class="header">
            <button class="nav-btn back-btn" onclick="goBack()">
                <i class="fas fa-chevron-left"></i>
            </button>
            <h1 class="title">相册管理</h1>
            <button class="nav-btn" id="batchToggleBtn" onclick="toggleBatchMode()">
                <i class="fas fa-check-square"></i>
            </button>
        </header>

        <!-- 相册信息 -->
        <div class="album-header">
            <div class="album-info">
                <h2 id="albumTitle">我们的回忆</h2>
                <div class="album-meta">
                    <span id="photoCount">12张照片</span> · 
                    <span id="albumDate">2024-01-15 创建</span>
                </div>
            </div>
        </div>

        <!-- 照片网格 -->
        <div class="photo-gallery" id="photoGallery">
            <!-- 示例照片 -->
            <div class="photo-item" data-photo-id="1">
                <img src="https://picsum.photos/150/150?random=1" alt="照片1">
                <div class="select-overlay">
                    <i class="fas fa-check-circle" style="color: white; font-size: 24px;"></i>
                </div>
                <div class="select-checkbox"></div>
            </div>
            <div class="photo-item" data-photo-id="2">
                <img src="https://picsum.photos/150/150?random=2" alt="照片2">
                <div class="select-overlay">
                    <i class="fas fa-check-circle" style="color: white; font-size: 24px;"></i>
                </div>
                <div class="select-checkbox"></div>
            </div>
            <div class="photo-item" data-photo-id="3">
                <img src="https://picsum.photos/150/150?random=3" alt="照片3">
                <div class="select-overlay">
                    <i class="fas fa-check-circle" style="color: white; font-size: 24px;"></i>
                </div>
                <div class="select-checkbox"></div>
            </div>
            <div class="photo-item" data-photo-id="4">
                <img src="https://picsum.photos/150/150?random=4" alt="照片4">
                <div class="select-overlay">
                    <i class="fas fa-check-circle" style="color: white; font-size: 24px;"></i>
                </div>
                <div class="select-checkbox"></div>
            </div>
            <div class="photo-item" data-photo-id="5">
                <img src="https://picsum.photos/150/150?random=5" alt="照片5">
                <div class="select-overlay">
                    <i class="fas fa-check-circle" style="color: white; font-size: 24px;"></i>
                </div>
                <div class="select-checkbox"></div>
            </div>
            <div class="photo-item" data-photo-id="6">
                <img src="https://picsum.photos/150/150?random=6" alt="照片6">
                <div class="select-overlay">
                    <i class="fas fa-check-circle" style="color: white; font-size: 24px;"></i>
                </div>
                <div class="select-checkbox"></div>
            </div>
        </div>

        <!-- 批量操作工具栏 -->
        <div class="batch-actions" id="batchActions">
            <div class="batch-info">
                已选择 <span id="selectedCount">0</span> 张照片
            </div>
            <div class="batch-buttons">
                <button class="batch-btn cancel" onclick="exitBatchMode()">取消</button>
                <button class="batch-btn delete" onclick="batchDeletePhotos()">删除照片</button>
                <button class="batch-btn album-delete" onclick="deleteAlbumWithPhotos()">删除相册</button>
            </div>
        </div>
    </div>

    <script>
        let isBatchMode = false;
        let selectedPhotos = new Set();

        // 切换批量选择模式
        function toggleBatchMode() {
            isBatchMode = !isBatchMode;
            const gallery = document.getElementById('photoGallery');
            const batchActions = document.getElementById('batchActions');
            const toggleBtn = document.getElementById('batchToggleBtn');
            
            if (isBatchMode) {
                gallery.classList.add('batch-mode');
                batchActions.classList.add('show');
                toggleBtn.innerHTML = '<i class="fas fa-times"></i>';
                toggleBtn.style.color = '#FF3B30';
            } else {
                exitBatchMode();
            }
        }

        // 退出批量选择模式
        function exitBatchMode() {
            isBatchMode = false;
            selectedPhotos.clear();
            
            const gallery = document.getElementById('photoGallery');
            const batchActions = document.getElementById('batchActions');
            const toggleBtn = document.getElementById('batchToggleBtn');
            
            gallery.classList.remove('batch-mode');
            batchActions.classList.remove('show');
            toggleBtn.innerHTML = '<i class="fas fa-check-square"></i>';
            toggleBtn.style.color = '';
            
            // 清除所有选中状态
            document.querySelectorAll('.photo-item').forEach(item => {
                item.classList.remove('selected');
                item.querySelector('.select-checkbox').classList.remove('checked');
            });
            
            updateSelectedCount();
        }

        // 更新选中数量显示
        function updateSelectedCount() {
            document.getElementById('selectedCount').textContent = selectedPhotos.size;
        }

        // 照片点击处理
        document.getElementById('photoGallery').addEventListener('click', function(e) {
            const photoItem = e.target.closest('.photo-item');
            if (!photoItem) return;
            
            if (isBatchMode) {
                const photoId = photoItem.dataset.photoId;
                const checkbox = photoItem.querySelector('.select-checkbox');
                
                if (selectedPhotos.has(photoId)) {
                    selectedPhotos.delete(photoId);
                    photoItem.classList.remove('selected');
                    checkbox.classList.remove('checked');
                } else {
                    selectedPhotos.add(photoId);
                    photoItem.classList.add('selected');
                    checkbox.classList.add('checked');
                }
                
                updateSelectedCount();
            } else {
                // 正常模式下查看照片详情
                console.log('查看照片详情:', photoItem.dataset.photoId);
            }
        });

        // 批量删除照片
        function batchDeletePhotos() {
            if (selectedPhotos.size === 0) {
                alert('请选择要删除的照片');
                return;
            }
            
            const photoIds = Array.from(selectedPhotos);
            const confirmMsg = `确定要删除选中的 ${photoIds.length} 张照片吗？`;
            
            if (confirm(confirmMsg)) {
                // 模拟API调用
                console.log('批量删除照片:', photoIds);
                
                // 实际实现中调用API
                /*
                fetch('/api/photos/batch?userId=1', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        photoIds: photoIds.map(id => parseInt(id))
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // 从界面移除已删除的照片
                        photoIds.forEach(photoId => {
                            const photoItem = document.querySelector(`[data-photo-id="${photoId}"]`);
                            if (photoItem) {
                                photoItem.remove();
                            }
                        });
                        
                        alert(`删除成功：${data.successCount} 张，失败：${data.failureCount} 张`);
                        exitBatchMode();
                        updatePhotoCount();
                    } else {
                        alert('删除失败：' + data.message);
                    }
                })
                .catch(error => {
                    console.error('删除失败:', error);
                    alert('删除失败，请重试');
                });
                */
                
                // 模拟删除成功
                photoIds.forEach(photoId => {
                    const photoItem = document.querySelector(`[data-photo-id="${photoId}"]`);
                    if (photoItem) {
                        photoItem.remove();
                    }
                });
                
                alert(`已删除 ${photoIds.length} 张照片`);
                exitBatchMode();
                updatePhotoCount();
            }
        }

        // 删除整个相册（包含所有照片）
        function deleteAlbumWithPhotos() {
            const totalPhotos = document.querySelectorAll('.photo-item').length;
            const confirmMsg = `确定要删除整个相册吗？\n这将删除相册中的所有 ${totalPhotos} 张照片，此操作不可撤销。`;
            
            if (confirm(confirmMsg)) {
                // 模拟API调用
                console.log('删除整个相册，包含所有照片');
                
                // 实际实现中调用API
                /*
                const albumId = getCurrentAlbumId(); // 获取当前相册ID
                fetch(`/api/albums/${albumId}?userId=1&deletePhotos=true`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert(`相册删除成功，共删除了 ${data.deletedPhotoCount} 张照片`);
                        // 返回上级页面
                        goBack();
                    } else {
                        alert('删除失败：' + data.message);
                    }
                })
                .catch(error => {
                    console.error('删除失败:', error);
                    alert('删除失败，请重试');
                });
                */
                
                // 模拟删除成功
                alert(`相册删除成功，共删除了 ${totalPhotos} 张照片`);
                goBack();
            }
        }

        // 更新照片数量显示
        function updatePhotoCount() {
            const count = document.querySelectorAll('.photo-item').length;
            document.getElementById('photoCount').textContent = `${count}张照片`;
        }

        // 返回上级页面
        function goBack() {
            // 实际实现中返回相册列表或主页
            console.log('返回上级页面');
            history.back();
        }

        // 初始化
        updateSelectedCount();
    </script>
</body>
</html>