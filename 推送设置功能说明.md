# 推送设置功能说明

## 功能概述
为纪念日添加了推送开关功能，用户可以在创建纪念日时选择是否启用推送通知，后续也可以随时修改。这样可以避免过多的无关通知，只专注于重要的纪念日。

## 数据库变更
在 `anniversaries` 表中新增字段：
- `enable_notification` (BOOLEAN): 是否启用推送通知，默认值为 `TRUE`

## 推送设置方式
- **创建时选择**：用户在添加纪念日时可以选择是否启用推送
- **后续修改**：可以随时切换推送开关
- **默认设置**：如果用户没有明确选择，默认启用推送

## API接口

### 基础功能
- **获取启用推送的纪念日**
  ```
  GET /api/anniversaries/couple/{coupleId}/notification-enabled
  ```

- **获取推送设置统计**
  ```
  GET /api/anniversaries/couple/{coupleId}/notification-stats
  ```

- **切换单个纪念日推送状态**
  ```
  PUT /api/anniversaries/{id}/notification-toggle
  ```

### 批量管理
- **批量设置推送开关**
  ```
  PUT /api/anniversaries/batch-notification
  请求体: {"anniversaryIds": [1,2,3], "enabled": true}
  ```

## 推送逻辑变更
- `/api/anniversaries/couple/{coupleId}/notifications` 接口现在只返回启用了推送的纪念日
- 新创建纪念日时如果用户没有设置推送状态，默认启用推送
- 用户可以随时修改推送设置

## 测试数据示例
```sql
INSERT INTO anniversaries (name, date, notes, couple_id, enable_notification) VALUES 
('初次相遇', '2023-05-20', '重要纪念日', 1, TRUE),     -- 用户选择启用推送
('第一次约会', '2023-06-14', '普通纪念日', 1, FALSE),   -- 用户选择不推送
('正式交往', '2023-07-01', '重要纪念日', 1, TRUE),     -- 用户选择启用推送
('小王的生日', '1995-08-15', '生日', 1, TRUE),         -- 用户选择启用推送
('小李的生日', '1996-12-03', '生日', 1, TRUE);         -- 用户选择启用推送
```

## 使用建议
1. **重要纪念日**（生日、恋爱纪念日等）建议启用推送
2. **普通纪念日**（第一次做某事）可根据个人喜好选择
3. 创建纪念日时主动选择推送设置
4. 定期查看推送统计，调整设置以获得最佳体验

## 数据库升级
如果已有数据库，需要执行以下SQL添加新字段：
```sql
ALTER TABLE anniversaries 
ADD COLUMN enable_notification BOOLEAN NOT NULL DEFAULT TRUE;

-- 添加索引优化查询
CREATE INDEX idx_couple_notification ON anniversaries(couple_id, enable_notification);
``` 