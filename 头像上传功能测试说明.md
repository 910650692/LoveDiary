# 头像上传功能测试说明

## 🎯 功能概述
用户头像上传功能已实现，支持上传、获取、删除头像，并根据性别自动设置默认头像。

## 📋 API接口列表

### 1. 上传头像
```
POST /api/users/{userId}/avatar/upload
Content-Type: multipart/form-data
Authorization: Bearer {token}

Body:
- file: 图片文件
```

**响应示例：**
```json
{
  "success": true,
  "message": "头像上传成功",
  "avatarUrl": "/uploads/avatars/user1_20241203143022.jpg",
  "filename": "user1_20241203143022.jpg"
}
```

### 2. 获取头像URL
```
GET /api/users/{userId}/avatar
Authorization: Bearer {token}
```

**响应示例：**
```json
{
  "success": true,
  "avatarUrl": "/uploads/avatars/user1_20241203143022.jpg"
}
```

### 3. 删除头像（恢复默认）
```
DELETE /api/users/{userId}/avatar
Authorization: Bearer {token}
```

**响应示例：**
```json
{
  "success": true,
  "message": "头像已恢复为默认头像",
  "avatarUrl": "/images/default-male.png"
}
```

## 🧪 测试步骤

### 0. 测试文件上传配置（可选）
```bash
curl -X POST http://localhost:8080/api/users/test-upload \
  -F "file=@/path/to/your/image.jpg"
```

**响应示例：**
```json
{
  "success": true,
  "message": "文件上传测试成功",
  "filename": "test.jpg",
  "size": 12345,
  "contentType": "image/jpeg"
}
```

### 1. 注册用户（带性别）
```bash
curl -X POST http://localhost:8080/api/users/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "123456",
    "nickname": "测试用户",
    "email": "test@example.com",
    "gender": "MALE"
  }'
```

### 2. 登录获取token
```bash
curl -X POST http://localhost:8080/api/users/login \
  -H "Content-Type: application/json" \
  -d '{
    "identifier": "testuser",
    "password": "123456"
  }'
```

### 3. 上传头像
```bash
curl -X POST http://localhost:8080/api/users/1/avatar/upload \
  -H "Authorization: Bearer {你的token}" \
  -F "file=@/path/to/your/image.jpg"
```

### 4. 获取头像URL
```bash
curl -X GET http://localhost:8080/api/users/1/avatar \
  -H "Authorization: Bearer {你的token}"
```

### 5. 删除头像
```bash
curl -X DELETE http://localhost:8080/api/users/1/avatar \
  -H "Authorization: Bearer {你的token}"
```

## 📁 文件存储结构

```
src/main/resources/static/
├── images/
│   ├── default-male.png      # 男性默认头像
│   └── default-female.png    # 女性默认头像
└── uploads/
    └── avatars/              # 用户上传的头像
        ├── user1_20241203143022.jpg
        └── user2_20241203143500.png
```

## 🔧 技术实现要点

### 1. 文件命名规则
- 格式：`user{用户ID}_{时间戳}.{扩展名}`
- 示例：`user1_20241203143022.jpg`

### 2. 权限控制
- 只能修改自己的头像
- 通过JWT token验证用户身份

### 3. 默认头像
- 男性：`/images/default-male.png`
- 女性：`/images/default-female.png`
- 注册时根据性别自动设置

### 4. 静态资源映射
- 上传文件：`/uploads/avatars/**`
- 默认头像：`/images/**`

## 🚨 注意事项

1. **文件大小**：目前没有限制，生产环境建议添加
2. **文件格式**：支持所有图片格式，生产环境建议限制
3. **存储位置**：开发环境使用本地存储，生产环境建议使用云存储
4. **默认头像**：需要手动添加真实的PNG图片文件

## 🎉 功能特色

✅ **自动默认头像** - 根据性别自动设置  
✅ **权限验证** - 只能修改自己的头像  
✅ **文件管理** - 自动删除旧头像文件  
✅ **URL访问** - 浏览器可直接访问头像  
✅ **错误处理** - 完善的异常处理机制  

现在可以开始测试头像上传功能了！ 🚀 