# 恋爱开始日期功能测试说明

## 🎯 功能概述
情侣匹配成功后，自动设置恋爱开始日期为当天，用户可以随时修改恋爱开始日期，系统自动计算恋爱天数、月数、年数。

## 📋 API接口列表

### 1. 获取情侣恋爱信息
```
GET /api/couples/{coupleId}/love-info
Authorization: Bearer {token}
```

**响应示例：**
```json
{
  "success": true,
  "data": {
    "loveStartDate": "2024-01-01",
    "loveDays": 365,
    "loveMonths": 12,
    "loveYears": 1
  }
}
```

### 2. 更新恋爱开始日期
```
PUT /api/couples/{coupleId}/love-start-date
Authorization: Bearer {token}
Content-Type: application/json

{
  "loveStartDate": "2024-02-14"
}
```

**响应示例：**
```json
{
  "success": true,
  "message": "恋爱开始日期更新成功",
  "data": {
    "loveStartDate": "2024-02-14",
    "loveDays": 320,
    "loveMonths": 10,
    "loveYears": 0
  }
}
```

### 3. 获取当前用户的恋爱信息
```
GET /api/couples/my/love-info
Authorization: Bearer {token}
```

**响应示例：**
```json
{
  "success": true,
  "data": {
    "loveStartDate": "2024-01-01",
    "loveDays": 365,
    "loveMonths": 12,
    "loveYears": 1
  }
}
```

## 🧪 测试步骤

### 1. 注册两个用户
```bash
# 注册用户A
curl -X POST http://localhost:8080/api/users/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "userA",
    "password": "123456",
    "nickname": "用户A",
    "gender": "MALE"
  }'

# 注册用户B
curl -X POST http://localhost:8080/api/users/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "userB",
    "password": "123456",
    "nickname": "用户B",
    "gender": "FEMALE"
  }'
```

### 2. 登录获取token
```bash
# 用户A登录
curl -X POST http://localhost:8080/api/users/login \
  -H "Content-Type: application/json" \
  -d '{
    "identifier": "userA",
    "password": "123456"
  }'
```

### 3. 获取邀请码
```bash
curl -X GET http://localhost:8080/api/users/1/invitation-code \
  -H "Authorization: Bearer {token}"
```

### 4. 情侣匹配
```bash
# 用户B登录后，使用用户A的邀请码匹配
curl -X POST http://localhost:8080/api/users/match \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer {userB的token}" \
  -d '{
    "invitationCode": "ABC123"
  }'
```

### 5. 获取恋爱信息
```bash
# 获取情侣的恋爱信息
curl -X GET http://localhost:8080/api/couples/1/love-info \
  -H "Authorization: Bearer {token}"

# 获取当前用户的恋爱信息
curl -X GET http://localhost:8080/api/couples/my/love-info \
  -H "Authorization: Bearer {token}"
```

### 6. 更新恋爱开始日期
```bash
curl -X PUT http://localhost:8080/api/couples/1/love-start-date \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer {token}" \
  -d '{
    "loveStartDate": "2024-02-14"
  }'
```

## 🔧 技术实现要点

### 1. 数据模型
```java
@Entity
public class Couple {
    private LocalDate loveStartDate;    // 恋爱开始日期
    private LocalDateTime matchDate;    // 匹配日期
}
```

### 2. 默认值设置
- 匹配成功时自动设置`loveStartDate`为当天
- 匹配成功时自动设置`matchDate`为当前时间

### 3. 权限控制
- 只有情侣双方可以修改恋爱开始日期
- 通过JWT token验证用户身份

### 4. 日期验证
- 不能是未来日期
- 不能超过10年前
- 不能为空

### 5. 计算逻辑
```java
// 计算恋爱天数
long days = ChronoUnit.DAYS.between(startDate, today);

// 计算恋爱月数
long months = ChronoUnit.MONTHS.between(startDate, today);

// 计算恋爱年数
long years = ChronoUnit.YEARS.between(startDate, today);
```

## 🎉 功能特色

✅ **自动设置** - 匹配时自动设置默认日期  
✅ **灵活修改** - 用户可以随时修改恋爱开始日期  
✅ **实时计算** - 自动计算恋爱天数、月数、年数  
✅ **权限控制** - 只有情侣双方可以修改  
✅ **数据验证** - 完善的日期验证逻辑  

## 🚨 注意事项

1. **数据库迁移** - 需要更新数据库表结构
2. **默认头像** - 需要添加真实的默认头像文件
3. **日期格式** - 使用ISO日期格式（YYYY-MM-DD）
4. **时区处理** - 使用系统默认时区

现在可以开始测试恋爱开始日期功能了！ 🚀 